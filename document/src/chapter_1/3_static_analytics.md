## 1.3 Использование статического анализа кода в задачах построения абстрактной модели представления

Статический анализ (СА) кода предполагает анализ программного обеспечения
через программный код без реального выполнения исследуемых программ. Таким образом,
СА позволяет находить проблемные места в программном коде ещё на этапе его написания,
не доходя до этапа компиляции. Статический анализ в основном используется в 
интегрированных средах разработки (IDE). Анализируя код, программное обеспечение (ПО)
выполняет разметку элементов синтаксиса поддерживаемого языка программирования,
тем самым подсвечивая их техническое обособление относительно создаваемых
разработчиком собственных программных элементов (переменных, функций, классов и пр.).
Помимо этого, статический анализ применяется для подсветки потенциальных 
проблем программного кода, которые могут не позволить скомпилировать итоговую программу.
Для реализации такого функционала используются lint-программы.

Помимо базовой работы IDE, статический анализ может 
решать и другие задачи на основе исходного кода программы. Например, СА применяется
для автоматического построения программной документации к разрабатываемому программному
обеспечению. Используя специально структурированные комментариеи в исходном коде данный
инструмент производит их считываение с учётом контекста их нахождения в программе (в классе,
функции и пр.), обрабатывает их и на основе полученной информации генерирует HTML-страницы
с описанием части программного кода. Такое автоматизированное решение позволяет
тратить кратно меньше времени на документирование написанного программного кода,
которое является приоритетным требованием при разработке переиспользуемых
программных инструментов. Ещё одним полезным инструментом на основе статического анализа является
автоматизированное графическое отображение исходного кода в виде диаграмм
в одной из стандартных графических нотаций (диаграмма классов UML, диаграмма
последовательности, диаграмма "сущность-связь" и др.). Это также позволяет
экономить время на документацию проекта и видеть карту проекта в более
удобном графическом представлении.

Помимо инструментов визуализации на основе программного кода
существует множество программного обеспечения, которое использует статический анализ
для интерпретации исходного кода в абстрактную модель представления.
Абстрактная модель может использоваться для преобразования в любой выходной 
формат представления, главной задачей программы при этом является умение считывать
и обрабатывать данные из представленной модели. Таким образом работает 
инструмент коммандой строки pandoc, который позволяет конвертировать
файл на одном языке разметки в любой из поддерживаемых. Это достигается за
счёт того, что pandoc обрабатывает при помощи статического анализа входной
файл и преобразует его в файл с абстрактной моделью представления, которую
сам же pandoc переводит в любой целевой формат разметки в соответствии
с правилами преобразования. Помимо этого, пользователь может написать свой 
обработчик абстрактного представления (фильтр), с помощью которого он может
дополнительно предобработать модель перед её конвертацией в целевой формат:
разметить элементы при помощи пользовательских тэгов, 
удалить лишние компоненты, отредактировать элементы определённого типа (@fig:pandoc-example). 

<!-- TODO: Втыкнуть тут какую-то схему pandoc -->
![Пример последовательности преобразований формата в pandoc](static/pandoc-example.png){#fig:pandoc-example}

На примере pandoc видно, что формирование абстрактной модели представления
является наиболее универсальным способом применения статического анализа, поскольку
позволяет использовать одну и ту же модель для решения широкого спектра задач, таких как
анализ структуры полученной модели, преобразование модели в разные выходные
форматы данных(это может быть, например, кодогенерация или отрисовка схемы в установленной нотации).
Таким образом, сформированная абстрактая модель представления может со временем расширяться
при возникновении новых задач статического анализа. 

Для формулировки принципа преобразования исходного кода в абстрактную
модель данных необходимо:

1) Определить структуру абстрактной модели представления;

2) Определить принципы и правила чтения выбранного исходного кода;

3) Определить правило соответствия элементов обработанных элементов исходного кода с компонентами абстрактной модели представления.

При определении абстрактной модели необходимо провести проанализировать
целевую предметную область, в частности, определить перечень задач, которые должна решать 
проектируемая модель. На основе этих задач необходимо выделить основные компоненты,
их свойства и взаимосвязи между ними. В том случае, если задачи требуют совсем
разных свойств от абстрактной модели, стоит рассмотреть создание сразу
нескольких моделей для разделения групп задач на каждую из абстракций.

После построения абстрактной модели, необходимо определить принципы исходного кода. 
Абстрактное синтаксическое дерево (Abstract syntax tree, AST) является одним из 
наиболее оптимальных вариантов интерпретации программного кода в промежуточную модель 
для последующей компиляции, поскольку позволяет анализатору проходить дерево 
в нужной для анализа последовательности и на требуемом уровне вложенности элементов (@fig:python-ast-example).

<!-- ! Пример AST на Python -->
![Пример AST на языке программирования Python](static/python-ast-example.png){#fig:python-ast-example}

Многие современные языки программирования, такие как Python, JavaScript или Golang,
имеют инструменты статического анализа кода через интерпретацию в виде 
абстрактного синтаксического дерева как в виде встроенных, так и 
внешних программных библиотек. Эти инструменты позволяют проводить собственный
автоматический анализ кода и его элементов, а также производить генерацию или
замену уже существующих элементов программного кода автоматически. Это 
позволяет разрабатывать собственные анализаторы для задач автоматизации
проверки стилизации кода (code style), проверки покрытия программных компонентов
тестами, проверки исходного кода на отсутствие секретных ключей в программном коде
и др.

На этапе определения правил чтения синтаксического дерева необходимо определить 
те элементы, которые необходимо учитывать при формировании абстрактной модели. 
Следует отметить, что при выполнении синтаксического анализа 
на нескольких языках программирования, стоит учитывать 
расхождения в синтаксисе и правилах определения базовых структур: функций,
циклов, условных операторов и пр. В таком случае необходимо сформировать правила соответствия
синтаксических структур программного кода между языками программирования, в результате чего
одинаковый программный код, написанный с учётом специфики выбранного языка программирования, 
будет интерпретироваться в абстрактной модели одинаково.

После построения бастрактной модели представления и сформулировки правил
обработки программного кода, необходимо определить, как будут соответствовать друг другу 
элементы программного кода с абстрактной моделью. При этом атрибуты абстрактной модели 
могут соотноситься с программой как напрямую (например, через название функции или признак 
приватности метода класса), так и выражаться через агрегированные значения (например, 
через количество применённых циклов в программе, число уровней вложенности условий внутри функции). 
Таким образом через программный код можно присваивать абстрактной модели 
как количественные, так и качественные характеристики, которые будут использоваться в анализе.